<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cartera Acciones Chile — MVP</title>
    <style>
      :root {
        color-scheme: light;
        --bg: #ffffff;
        --text: #111111;
        --muted: #666666;
        --border: #eaeaea;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 40px 20px;
        background: var(--bg);
        color: var(--text);
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial,
          sans-serif;
        line-height: 1.45;
      }

      .container {
        max-width: 1080px;
        margin: 0 auto;
      }

      h1 {
        margin: 0 0 24px;
        font-size: clamp(1.4rem, 2.5vw, 2rem);
        font-weight: 600;
        letter-spacing: -0.02em;
      }

      .grid {
        display: grid;
        grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
        gap: 20px;
      }

      .panel {
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 20px;
        background: #fff;
      }

      form {
        display: grid;
        gap: 14px;
      }

      label {
        display: grid;
        gap: 6px;
        font-size: 0.9rem;
        font-weight: 500;
      }

      input,
      select,
      textarea,
      button {
        width: 100%;
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 12px;
        background: #fff;
        color: var(--text);
        font: inherit;
      }

      textarea {
        min-height: 92px;
        resize: vertical;
      }

      input:focus,
      select:focus,
      textarea:focus,
      button:focus {
        outline: 2px solid #000;
        outline-offset: 1px;
      }

      button {
        cursor: pointer;
        font-weight: 600;
      }

      button[disabled] {
        cursor: not-allowed;
        opacity: 0.6;
      }

      .status {
        min-height: 20px;
        margin: 8px 0 0;
        font-size: 0.85rem;
      }

      .status.error {
        color: #000;
        font-weight: 600;
      }

      .output-box {
        margin: 0;
        min-height: 420px;
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 16px;
        white-space: pre-wrap;
        word-break: break-word;
        overflow-wrap: anywhere;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",
          "Courier New", monospace;
        font-size: 0.9rem;
      }

      .disclaimer {
        margin: 12px 0 0;
        font-size: 0.8rem;
        color: var(--muted);
      }

      @media (max-width: 840px) {
        body {
          padding: 24px 14px;
        }

        .grid {
          grid-template-columns: 1fr;
        }

        .output-box {
          min-height: 320px;
        }
      }
    </style>
  </head>
  <body>
    <main class="container">
      <h1>Cartera Acciones Chile — MVP</h1>

      <section class="grid">
        <article class="panel">
          <form id="portfolioForm">
            <label>
              Capital (CLP)
              <input id="capital" name="capital" type="number" min="1" step="1" required />
            </label>

            <label>
              Investment horizon (years)
              <input id="horizon" name="horizon" type="number" min="1" step="1" required />
            </label>

            <label>
              Risk level
              <select id="risk" name="risk" required>
                <option value="">Selecciona nivel</option>
                <option value="Low">Low</option>
                <option value="Medium">Medium</option>
                <option value="Medium-High">Medium-High</option>
                <option value="High">High</option>
              </select>
            </label>

            <label>
              Objective
              <input id="objective" name="objective" type="text" maxlength="200" required />
            </label>

            <label>
              Optional constraints
              <textarea id="constraints" name="constraints" maxlength="800"></textarea>
            </label>

            <button id="submitBtn" type="submit">Generar cartera</button>
            <p id="status" class="status" role="status" aria-live="polite"></p>
          </form>
        </article>

        <article class="panel">
          <pre id="output" class="output-box">Completa el formulario para generar una simulación.</pre>
          <p class="disclaimer">Simulación educativa. No es asesoría financiera.</p>
        </article>
      </section>
    </main>

    <script>
      const form = document.getElementById("portfolioForm");
      const button = document.getElementById("submitBtn");
      const statusEl = document.getElementById("status");
      const outputEl = document.getElementById("output");

      form.addEventListener("submit", async (event) => {
        event.preventDefault();

        const payload = {
          capital: form.capital.value.trim(),
          horizon: form.horizon.value.trim(),
          risk: form.risk.value,
          objective: form.objective.value.trim(),
          constraints: form.constraints.value.trim(),
        };

        button.disabled = true;
        button.textContent = "Generando...";
        statusEl.className = "status";
        statusEl.textContent = "Consultando simulación...";
        outputEl.textContent = "Cargando resultado...";

        try {
          const response = await fetch("/api/recommend", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          const data = await response.json();

          if (!response.ok) {
            throw new Error(data.error || "No fue posible generar la cartera.");
          }

          outputEl.textContent = data.text || data.result || "Sin contenido.";
          statusEl.textContent = "Simulación generada.";
        } catch (error) {
          statusEl.className = "status error";
          statusEl.textContent = error.message || "Error inesperado.";
          outputEl.textContent = "No se pudo generar la simulación en este momento.";
        } finally {
          button.disabled = false;
          button.textContent = "Generar cartera";
        }
      });
    </script>
  </body>
</html>
